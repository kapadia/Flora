// Generated by CoffeeScript 1.3.3
(function() {
  var DataOnWire,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  DataOnWire = (function() {

    DataOnWire.validOrigins = ["http://0.0.0.0:9294"];

    function DataOnWire() {
      this.sendMessage = __bind(this.sendMessage, this);

      this.requestXHR = __bind(this.requestXHR, this);

      this.receiveMessage = __bind(this.receiveMessage, this);
      window.addEventListener("message", this.receiveMessage, false);
    }

    DataOnWire.prototype.receiveMessage = function(e) {
      var reference;
      console.log("receiveMessage called from DataOnWire");
      reference = e.data.reference;
      return this.requestXHR(reference);
    };

    DataOnWire.prototype.requestXHR = function(reference) {
      var url,
        _this = this;
      console.log('requestXHR called from DataOnWire');
      url = "http://0.0.0.0:9296/data/" + reference + ".fits";
      return (function(url, reference) {
        var xhr;
        xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.responseType = 'arraybuffer';
        xhr.onload = function(e) {
          var msg;
          msg = {
            origin: url,
            reference: reference,
            arraybuffer: e.currentTarget.response
          };
          return _this.sendMessage(msg);
        };
        return xhr.send();
      })(url, reference);
    };

    DataOnWire.prototype.sendMessage = function(msg) {
      console.log('sendMessage called from DataOnWire');
      return window.parent.postMessage(msg, DataOnWire.validOrigins[0]);
    };

    return DataOnWire;

  })();

  this.DataOnWire = DataOnWire;

}).call(this);
